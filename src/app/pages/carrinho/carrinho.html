<div class="space-y-8">
  <div class="flex flex-wrap items-center justify-between gap-4">
    <div>
      <p class="text-sm uppercase tracking-[0.3em] text-primary-500">Resumo</p>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-50">Meu carrinho</h1>
    </div>
    <div class="flex flex-wrap gap-3">
      <a pButton routerLink="/ingressos" label="Escolher ingressos" icon="pi pi-ticket" severity="secondary"></a>
      <a pButton routerLink="/produtos" label="Adicionar produtos" icon="pi pi-gift"></a>
    </div>
  </div>

  <div class="grid gap-6 lg:grid-cols-3">
    <div class="space-y-6 lg:col-span-2">
      <p-card>
        <ng-template pTemplate="header">
          <div class="flex items-center justify-between p-4">
            <div>
              <p class="text-xs uppercase tracking-[0.3em] text-gray-400">Ingressos</p>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-50">Itens selecionados</h3>
            </div>
            <span class="text-sm font-semibold text-gray-500">{{ purchaseData()?.eventName }}</span>
          </div>
        </ng-template>

        <div class="space-y-3">
          @if (purchaseData() && hasTickets()) {
            @for (category of purchaseData()!.categories; track category.categoryId) {
              @if (category.quantity > 0) {
                <div class="flex items-center justify-between rounded-lg border border-gray-100 px-3 py-2 dark:border-gray-800">
                  <div>
                    <p class="font-medium text-gray-900 dark:text-gray-50">{{ category.label }}</p>
                    <p class="text-xs text-gray-500">{{ category.quantity }} x {{ category.type }}</p>
                  </div>
                  <span class="text-sm font-semibold text-primary-600">
                    {{ (category.quantity * category.unitPrice) | currency: 'BRL':'symbol-narrow':'1.2-2' }}
                  </span>
                </div>
              }
            }
          } @else {
            <div class="rounded-xl border border-dashed border-gray-200 bg-gray-50 p-6 text-center text-sm text-gray-500">
              Nenhum ingresso selecionado ainda. Escolha um evento para continuar.
            </div>
          }
        </div>
      </p-card>

      <p-card>
        <ng-template pTemplate="header">
          <div class="flex items-center justify-between p-4">
            <div>
              <p class="text-xs uppercase tracking-[0.3em] text-gray-400">Loja</p>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-50">Produtos adicionados</h3>
            </div>
            <a
              class="text-sm font-semibold text-primary-600 hover:text-primary-500"
              routerLink="/produtos"
            >
              Ver loja
            </a>
          </div>
        </ng-template>

        <div class="space-y-3">
          @if (productSelections().length) {
            @for (item of productSelections(); track item.productId + '-' + item.availabilityId) {
              <div class="flex items-center gap-4 rounded-lg border border-gray-100 p-3 dark:border-gray-800">
                <img
                  [src]="item.imageUrl || 'https://placehold.co/120x120/0ea5e9/ffffff?text=+'"
                  [alt]="item.productName"
                  class="h-16 w-16 rounded-lg object-cover"
                />
                <div class="flex-1">
                  <p class="font-semibold text-gray-900 dark:text-gray-50">{{ item.productName }}</p>
                  <p class="text-xs text-gray-500">{{ item.availabilityLabel }} • {{ item.quantity }}x</p>
                </div>
                <div class="text-right">
                  <p class="text-sm font-semibold text-primary-600">
                    {{ (item.quantity * item.unitPrice) | currency: 'BRL':'symbol-narrow':'1.2-2' }}
                  </p>
                  <button
                    type="button"
                    class="text-xs font-semibold text-red-500 hover:text-red-600"
                    (click)="removeProduct(item)"
                  >
                    Remover
                  </button>
                </div>
              </div>
            }
          } @else {
            <div class="rounded-xl border border-dashed border-gray-200 bg-gray-50 p-6 text-center text-sm text-gray-500">
              Nenhum produto adicionado. Explore a loja para incluir camisetas, brindes e outros itens.
            </div>
          }
        </div>
      </p-card>
    </div>

    <div>
      <p-card>
        <div class="space-y-4">
          <div class="flex justify-between text-sm text-gray-600 dark:text-gray-300">
            <span>Ingressos</span>
            <span class="font-semibold">
              {{ ticketsSubtotal() | currency: 'BRL':'symbol-narrow':'1.2-2' }}
            </span>
          </div>
          <div class="flex justify-between text-sm text-gray-600 dark:text-gray-300">
            <span>Produtos</span>
            <span class="font-semibold">
              {{ productsSubtotal() | currency: 'BRL':'symbol-narrow':'1.2-2' }}
            </span>
          </div>
          <div class="flex justify-between border-t border-dashed border-gray-200 pt-4 text-lg font-bold text-gray-900 dark:text-gray-50">
            <span>Total do pedido</span>
            <span class="text-primary-600">
              {{ orderTotal() | currency: 'BRL':'symbol-narrow':'1.2-2' }}
            </span>
          </div>
          <p class="text-xs text-gray-500">Os valores finais podem incluir taxas conforme o método de pagamento.</p>
          <p-button
            label="Finalizar compra"
            icon="pi pi-check"
            styleClass="w-full"
            [disabled]="!purchaseData() || !hasTickets()"
            (click)="finalizarCompra()"
          />
        </div>
      </p-card>
    </div>
  </div>
</div>
